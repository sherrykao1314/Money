<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¯æ„›ç¹½ç´›è¨˜å¸³æœ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#FFFBF5',
                        'soft-brown': '#6B5B55',
                        'cute-pink': '#FF9AA2',
                        'cute-blue': '#A2CFFE',
                        'cute-yellow': '#FDFD96',
                        'cute-green': '#B5EAD7',
                    },
                    borderRadius: { '3xl': '1.5rem', '4xl': '2rem' }
                }
            }
        }
    </script>
    <style>
        body { font-family: "Noto Sans TC", sans-serif; background-color: #FFFBF5; color: #6B5B55; -webkit-tap-highlight-color: transparent; }
        .btn-bounce:active { transform: scale(0.95); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-cream p-6 min-h-screen bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSIjRkY5QUEyIiBmaWxsLW9wYWNpdHk9IjAuMSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIyIi8+PC9nPjwvc3ZnPg==')]">

    <header class="mt-16 mb-12 text-center">
        <p class="text-cute-pink font-bold tracking-widest mb-3 text-lg">âœ¨ é€™å€‹æœˆèŠ±äº†å¤šå°‘éŒ¢ï¼Ÿ</p>
        <h1 id="total-amount" class="text-6xl font-black tracking-tight text-cute-pink drop-shadow-sm" style="-webkit-text-stroke: 2px #fff;">$0</h1>
    </header>

    <main class="mb-32">
        <h2 class="text-cute-pink/80 font-bold text-sm mb-6 ml-2">ğŸŒ· æœ€è¿‘çš„å°æ•—å®¶ç´€éŒ„</h2>
        <div id="list" class="space-y-4"></div>
    </main>

    <button onclick="toggleModal()" class="btn-bounce fixed bottom-8 right-8 w-16 h-16 bg-cute-pink text-white rounded-full text-4xl shadow-lg shadow-cute-pink/40 flex items-center justify-center leading-none pb-1 z-40">+</button>

    <div id="modal" class="fixed inset-0 bg-cream/95 backdrop-blur-sm hidden p-6 z-50 flex flex-col justify-center transition-all duration-300 opacity-0 scale-95">
        <div class="bg-white p-8 rounded-4xl shadow-xl border-4 border-cute-pink/20 w-full max-w-md mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-bold text-cute-pink">ğŸ“ è¨˜ä¸Šä¸€ç­†</h3>
                <button onclick="toggleModal()" class="text-gray-400 bg-gray-100 rounded-full w-10 h-10 font-bold">âœ•</button>
            </div>
            
            <div class="relative mb-8">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-4xl text-cute-pink font-bold">$</span>
                <input type="number" id="amount" placeholder="0" class="w-full text-5xl font-bold pl-12 pr-4 py-4 bg-pink-50 rounded-3xl text-cute-pink outline-none border-2 border-transparent focus:border-cute-pink transition-all text-center">
            </div>
            
            <div class="grid grid-cols-4 gap-3 mb-6">
                <button onclick="setCategory('åƒå–', this)" class="cat-btn btn-bounce border-2 border-cute-pink text-cute-pink py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-pink-50">
                    <span class="text-2xl mb-1">ğŸ±</span>åƒå–
                </button>
                <button onclick="setCategory('ç”Ÿæ´»', this)" class="cat-btn btn-bounce border-2 border-cute-blue text-cute-blue py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-blue-50">
                    <span class="text-2xl mb-1">ğŸ </span>ç”Ÿæ´»
                </button>
                <button onclick="setCategory('å¨›æ¨‚', this)" class="cat-btn btn-bounce border-2 border-cute-yellow text-yellow-500 py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-yellow-50">
                    <span class="text-2xl mb-1">ğŸ®</span>å¨›æ¨‚
                </button>
                <button onclick="setCategory('å…¶ä»–', this)" class="cat-btn btn-bounce border-2 border-cute-green text-teal-500 py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-green-50">
                    <span class="text-2xl mb-1">âœ¨</span>å…¶ä»–
                </button>
            </div>

            <div id="other-input-container" class="mb-8 hidden fade-in">
                <input type="text" id="other-remark" placeholder="æƒ³å¯«é»ä»€éº¼ï¼Ÿ(ä¾‹å¦‚ï¼šè²·æ–‡å…·)" class="w-full p-4 bg-gray-50 rounded-2xl border-2 border-dashed border-cute-green outline-none focus:border-solid focus:border-cute-green text-center">
            </div>

            <button onclick="saveEntry()" class="btn-bounce w-full bg-cute-pink hover:bg-pink-400 text-white py-5 rounded-3xl font-bold text-xl shadow-lg shadow-pink-200">âœ¨ å­˜æª”ï¼</button>
        </div>
    </div>

    <script>
        let selectedCategory = 'åƒå–';
        const categoryDecor = {
            'åƒå–': { emoji: 'ğŸ±', color: 'text-cute-pink', bg: 'bg-pink-100' },
            'ç”Ÿæ´»': { emoji: 'ğŸ ', color: 'text-cute-blue', bg: 'bg-blue-100' },
            'å¨›æ¨‚': { emoji: 'ğŸ®', color: 'text-yellow-500', bg: 'bg-yellow-100' },
            'å…¶ä»–': { emoji: 'âœ¨', color: 'text-teal-500', bg: 'bg-green-100' }
        };

        let records = JSON.parse(localStorage.getItem('my_cute_ledger_v2') || '[]');

        function toggleModal() {
            const m = document.getElementById('modal');
            if (m.classList.contains('hidden')) {
                m.classList.remove('hidden');
                setTimeout(() => {
                    m.classList.remove('opacity-0', 'scale-95');
                    document.getElementById('amount').focus();
                }, 10);
            } else {
                m.classList.add('opacity-0', 'scale-95');
                setTimeout(() => m.classList.add('hidden'), 300);
            }
        }

        function setCategory(cat, btnElement) {
            selectedCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.className = "cat-btn btn-bounce border-2 py-3 rounded-2xl font-bold text-sm flex flex-col items-center";
                if(btn.innerText.includes('åƒå–')) btn.classList.add('border-cute-pink', 'text-cute-pink', 'bg-pink-50');
                if(btn.innerText.includes('ç”Ÿæ´»')) btn.classList.add('border-cute-blue', 'text-cute-blue', 'bg-blue-50');
                if(btn.innerText.includes('å¨›æ¨‚')) btn.classList.add('border-cute-yellow', 'text-yellow-500', 'bg-yellow-50');
                if(btn.innerText.includes('å…¶ä»–')) btn.classList.add('border-cute-green', 'text-teal-500', 'bg-green-50');
            });

            // é¸ä¸­ç‹€æ…‹
            btnElement.classList.remove('bg-pink-50', 'bg-blue-50', 'bg-yellow-50', 'bg-green-50', 'text-cute-pink', 'text-cute-blue', 'text-yellow-500', 'text-teal-500');
            btnElement.classList.add('text-white', 'border-transparent');
            if(cat === 'åƒå–') btnElement.classList.add('bg-cute-pink');
            if(cat === 'ç”Ÿæ´»') btnElement.classList.add('bg-cute-blue');
            if(cat === 'å¨›æ¨‚') btnElement.classList.add('bg-cute-yellow');
            if(cat === 'å…¶ä»–') btnElement.classList.add('bg-cute-green');

            // è™•ç†å…¶ä»–æ‰“å­—é …ç›®çš„é¡¯ç¤º
            const otherInput = document.getElementById('other-input-container');
            if (cat === 'å…¶ä»–') {
                otherInput.classList.remove('hidden');
                document.getElementById('other-remark').focus();
            } else {
                otherInput.classList.add('hidden');
            }
        }

        function saveEntry() {
            const amount = document.getElementById('amount').value;
            const remark = document.getElementById('other-remark').value;
            
            if(!amount || amount <= 0) return;
            
            const entry = {
                id: Date.now(),
                amount: parseFloat(amount),
                category: selectedCategory,
                remark: selectedCategory === 'å…¶ä»–' ? remark : '',
                date: new Date().toISOString()
            };

            records.unshift(entry);
            localStorage.setItem('my_cute_ledger_v2', JSON.stringify(records));
            
            // é‡ç½®è¼¸å…¥
            document.getElementById('amount').value = '';
            document.getElementById('other-remark').value = '';
            document.getElementById('other-input-container').classList.add('hidden');
            toggleModal();
            render();
        }

        function render() {
            const list = document.getElementById('list');
            const totalDisplay = document.getElementById('total-amount');
            let total = 0;
            const now = new Date();

            list.innerHTML = '';
            if (records.length === 0) {
                list.innerHTML = `<div class="text-center text-gray-400 py-10">ç©ºçš„ï½å¿«å»è¨˜ä¸€ç­†å§ï¼</div>`;
            }

            records.forEach((r, index) => {
                const date = new Date(r.date);
                if(date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear()) {
                    total += r.amount;
                }

                if(index < 20) {
                    const decor = categoryDecor[r.category] || categoryDecor['å…¶ä»–'];
                    // å¦‚æœæœ‰å‚™è¨»å°±é¡¯ç¤ºå‚™è¨»ï¼Œå¦å‰‡é¡¯ç¤ºé¡åˆ¥å
                    const displayName = (r.category === 'å…¶ä»–' && r.remark) ? r.remark : r.category;
                    
                    list.innerHTML += `
                        <div class="flex justify-between items-center bg-white p-4 rounded-3xl shadow-sm border-2 border-pink-50/50 fade-in">
                            <div class="flex items-center">
                                <div class="w-12 h-12 ${decor.bg} rounded-2xl flex items-center justify-center text-2xl mr-4">${decor.emoji}</div>
                                <div>
                                    <div class="font-bold text-soft-brown">${displayName}</div>
                                    <div class="text-gray-400 text-xs mt-1">${date.getMonth()+1}/${date.getDate()} Â· ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}</div>
                                </div>
                            </div>
                            <div class="font-black text-xl ${decor.color}">-$${r.amount}</div>
                        </div>
                    `;
                }
            });
            totalDisplay.innerText = `$${total.toLocaleString()}`;
        }

        render();
    </script>
</body>
</html>
