<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¯æ„›è£œå¸³æ—¥æ›†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#FFFBF5',
                        'soft-brown': '#6B5B55',
                        'cute-pink': '#FF9AA2',
                        'cute-blue': '#A2CFFE',
                        'cute-yellow': '#FDFD96',
                        'cute-green': '#B5EAD7',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: "Noto Sans TC", sans-serif; background-color: #FFFBF5; color: #6B5B55; -webkit-tap-highlight-color: transparent; }
        .btn-bounce:active { transform: scale(0.95); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .dot { width: 4px; height: 4px; background-color: #FF9AA2; border-radius: 50%; margin: 2px auto 0; }
        .selected-day { background-color: #FF9AA2 !important; color: white !important; border-radius: 12px; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        /* ç¾åŒ–æ—¥æœŸé¸æ“‡å™¨ */
        input[type="date"]::-webkit-calendar-picker-indicator { background: transparent; color: transparent; cursor: pointer; height: 100%; width: 100%; position: absolute; top: 0; left: 0; }
    </style>
</head>
<body class="bg-cream min-h-screen pb-32">

    <header class="pt-12 pb-6 px-6 bg-white rounded-b-[3rem] shadow-sm text-center mb-6">
        <div class="flex justify-between items-center mb-4 max-w-xs mx-auto">
            <button onclick="changeMonth(-1)" class="p-2 text-cute-pink font-bold text-xl">â®</button>
            <h2 id="current-month-label" class="text-xl font-black text-soft-brown">2024å¹´ 5æœˆ</h2>
            <button onclick="changeMonth(1)" class="p-2 text-cute-pink font-bold text-xl">â¯</button>
        </div>
        <p class="text-gray-400 text-xs font-bold tracking-widest mb-1">æœ¬æœˆç´¯è¨ˆæ”¯å‡º</p>
        <h1 id="total-amount" class="text-4xl font-black text-cute-pink">$0</h1>
    </header>

    <main class="max-w-md mx-auto px-6">
        <div class="bg-white rounded-3xl p-4 shadow-sm mb-8">
            <div class="calendar-grid text-center text-[10px] font-bold text-gray-300 mb-2">
                <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
            </div>
            <div id="calendar-days" class="calendar-grid text-center"></div>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h3 id="list-title" class="font-bold text-sm text-cute-pink/80 ml-2">ğŸŒ· ç´€éŒ„æ˜ç´°</h3>
            <button onclick="resetFilter()" id="reset-btn" class="text-[10px] bg-gray-100 px-2 py-1 rounded-lg hidden">é¡¯ç¤ºå…¨æœˆ</button>
        </div>
        <div id="list" class="space-y-3"></div>
    </main>

    <button onclick="toggleModal()" class="btn-bounce fixed bottom-8 right-8 w-16 h-16 bg-cute-pink text-white rounded-full text-4xl shadow-lg z-40 flex items-center justify-center">+</button>

    <div id="modal" class="fixed inset-0 bg-cream/95 backdrop-blur-sm hidden p-6 z-50 flex flex-col justify-center transition-all duration-300 opacity-0 scale-95">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border-4 border-cute-pink/20 w-full max-w-sm mx-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cute-pink">ğŸ“ è¨˜ä¸Šä¸€ç­†</h3>
                <button onclick="toggleModal()" class="text-gray-300">âœ•</button>
            </div>

            <div class="relative mb-4">
                <input type="date" id="entry-date" class="w-full p-2 bg-gray-50 rounded-xl text-center text-sm font-bold text-soft-brown outline-none border-2 border-transparent focus:border-cute-pink/30">
                <div class="text-[10px] text-center text-gray-400 mt-1">å¿˜è¨˜è¨˜å¸³ï¼Ÿå¯ä»¥è£œé¸æ—¥æœŸå–”ï¼</div>
            </div>
            
            <input type="number" id="amount" placeholder="å¤šå°‘éŒ¢ï¼Ÿ" class="w-full text-4xl font-bold p-4 bg-pink-50 rounded-2xl text-cute-pink outline-none mb-6 text-center">
            
            <div class="grid grid-cols-4 gap-2 mb-6">
                <button onclick="setCategory('åƒå–', this)" class="cat-btn btn-bounce border-2 border-cute-pink text-cute-pink py-3 rounded-xl font-bold text-xs bg-pink-50">ğŸ±<br>åƒå–</button>
                <button onclick="setCategory('ç”Ÿæ´»', this)" class="cat-btn btn-bounce border-2 border-cute-blue text-cute-blue py-3 rounded-xl font-bold text-xs bg-blue-50">ğŸ <br>ç”Ÿæ´»</button>
                <button onclick="setCategory('å¨›æ¨‚', this)" class="cat-btn btn-bounce border-2 border-cute-yellow text-yellow-500 py-3 rounded-xl font-bold text-xs bg-yellow-50">ğŸ®<br>å¨›æ¨‚</button>
                <button onclick="setCategory('å…¶ä»–', this)" class="cat-btn btn-bounce border-2 border-cute-green text-teal-500 py-3 rounded-xl font-bold text-xs bg-green-50">âœ¨<br>å…¶ä»–</button>
            </div>

            <div id="other-input-container" class="mb-6 hidden">
                <input type="text" id="other-remark" placeholder="å¯«ä¸‹å…§å®¹..." class="w-full p-3 bg-gray-50 rounded-xl border-2 border-dashed border-cute-green outline-none text-center">
            </div>

            <button onclick="saveEntry()" class="w-full bg-cute-pink text-white py-4 rounded-2xl font-bold text-lg">âœ¨ å­˜æª”ï¼</button>
        </div>
    </div>

    <script>
        let viewDate = new Date();
        let selectedDateStr = null;
        let selectedCategory = 'åƒå–';
        let records = JSON.parse(localStorage.getItem('my_calendar_ledger_v5') || '[]');

        const categoryDecor = {
            'åƒå–': { emoji: 'ğŸ±', color: 'text-cute-pink', bg: 'bg-pink-100' },
            'ç”Ÿæ´»': { emoji: 'ğŸ ', color: 'text-cute-blue', bg: 'bg-blue-100' },
            'å¨›æ¨‚': { emoji: 'ğŸ®', color: 'text-yellow-500', bg: 'bg-yellow-100' },
            'å…¶ä»–': { emoji: 'âœ¨', color: 'text-teal-500', bg: 'bg-green-100' }
        };

        function changeMonth(step) {
            viewDate.setMonth(viewDate.getMonth() + step);
            selectedDateStr = null;
            render();
        }

        function resetFilter() {
            selectedDateStr = null;
            render();
        }

        function toggleModal() {
            const m = document.getElementById('modal');
            if (m.classList.contains('hidden')) {
                // é–‹å•Ÿè¦–çª—æ™‚ï¼Œé è¨­æ—¥æœŸç‚ºä»Šå¤©
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('entry-date').value = today;
                
                m.classList.remove('hidden');
                setTimeout(() => m.classList.remove('opacity-0', 'scale-95'), 10);
            } else {
                m.classList.add('opacity-0', 'scale-95');
                setTimeout(() => m.classList.add('hidden'), 300);
            }
        }

        function setCategory(cat, btnElement) {
            selectedCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.className = "cat-btn btn-bounce border-2 py-3 rounded-xl font-bold text-xs flex flex-col items-center";
                if(btn.innerText.includes('åƒå–')) btn.classList.add('border-cute-pink', 'text-cute-pink', 'bg-pink-50');
                if(btn.innerText.includes('ç”Ÿæ´»')) btn.classList.add('border-cute-blue', 'text-cute-blue', 'bg-blue-50');
                if(btn.innerText.includes('å¨›æ¨‚')) btn.classList.add('border-cute-yellow', 'text-yellow-500', 'bg-yellow-50');
                if(btn.innerText.includes('å…¶ä»–')) btn.classList.add('border-cute-green', 'text-teal-500', 'bg-green-50');
            });
            btnElement.classList.add('text-white', 'border-transparent');
            if(cat === 'åƒå–') btnElement.classList.add('bg-cute-pink');
            if(cat === 'ç”Ÿæ´»') btnElement.classList.add('bg-cute-blue');
            if(cat === 'å¨›æ¨‚') btnElement.classList.add('bg-cute-yellow');
            if(cat === 'å…¶ä»–') btnElement.classList.add('bg-cute-green');
            document.getElementById('other-input-container').classList.toggle('hidden', cat !== 'å…¶ä»–');
        }

        function saveEntry() {
            const amount = document.getElementById('amount').value;
            const chosenDate = document.getElementById('entry-date').value;
            if(!amount || amount <= 0) return;
            
            // å­˜æª”æ™‚ä½¿ç”¨ä½¿ç”¨è€…é¸æ“‡çš„æ—¥æœŸ
            const entryDate = new Date(chosenDate);
            // åŠ ä¸Šç•¶å‰æ™‚é–“çš„åˆ†ç§’ï¼Œç¢ºä¿æ’åºæ­£ç¢º
            const now = new Date();
            entryDate.setHours(now.getHours(), now.getMinutes(), now.getSeconds());

            records.push({
                id: Date.now(),
                amount: parseFloat(amount),
                category: selectedCategory,
                remark: selectedCategory === 'å…¶ä»–' ? document.getElementById('other-remark').value : '',
                date: entryDate.toISOString()
            });

            // æ ¹æ“šæ—¥æœŸé‡æ–°æ’åº
            records.sort((a, b) => new Date(b.date) - new Date(a.date));

            localStorage.setItem('my_calendar_ledger_v5', JSON.stringify(records));
            document.getElementById('amount').value = '';
            document.getElementById('other-remark').value = '';
            toggleModal();
            render();
        }

        function deleteEntry(id) {
            if(confirm('è¦åˆªé™¤å—ï¼Ÿ')) {
                records = records.filter(r => r.id !== id);
                localStorage.setItem('my_calendar_ledger_v5', JSON.stringify(records));
                render();
            }
        }

        function render() {
            const daysContainer = document.getElementById('calendar-days');
            const listContainer = document.getElementById('list');
            const monthLabel = document.getElementById('current-month-label');
            const totalDisplay = document.getElementById('total-amount');
            const listTitle = document.getElementById('list-title');
            const resetBtn = document.getElementById('reset-btn');

            monthLabel.innerText = `${viewDate.getFullYear()}å¹´ ${viewDate.getMonth() + 1}æœˆ`;

            daysContainer.innerHTML = '';
            const firstDay = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay();
            const lastDate = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) daysContainer.innerHTML += `<div></div>`;

            let monthTotal = 0;
            for (let d = 1; d <= lastDate; d++) {
                const dateStr = `${viewDate.getFullYear()}-${viewDate.getMonth() + 1}-${d}`;
                const hasRecord = records.some(r => {
                    const rd = new Date(r.date);
                    return rd.getFullYear() === viewDate.getFullYear() && rd.getMonth() === viewDate.getMonth() && rd.getDate() === d;
                });

                const isSelected = selectedDateStr === dateStr;
                daysContainer.innerHTML += `
                    <div onclick="selectDay('${dateStr}')" class="py-2 text-sm font-bold cursor-pointer transition-all ${isSelected ? 'selected-day' : 'text-soft-brown'}">
                        ${d}${hasRecord ? '<div class="dot"></div>' : '<div class="h-[6px]"></div>'}
                    </div>
                `;
            }

            listContainer.innerHTML = '';
            const filteredRecords = records.filter(r => {
                const rd = new Date(r.date);
                const isSameMonth = rd.getFullYear() === viewDate.getFullYear() && rd.getMonth() === viewDate.getMonth();
                if (isSameMonth) monthTotal += r.amount;

                if (selectedDateStr) {
                    const [y, m, d] = selectedDateStr.split('-').map(Number);
                    return rd.getFullYear() === y && rd.getMonth() === m - 1 && rd.getDate() === d;
                }
                return isSameMonth;
            });

            totalDisplay.innerText = `$${monthTotal.toLocaleString()}`;
            listTitle.innerText = selectedDateStr ? `ğŸ“… ${selectedDateStr.split('-')[2]}æ—¥çš„ç´€éŒ„` : `ğŸŒ· æœ¬æœˆç´€éŒ„`;
            resetBtn.classList.toggle('hidden', !selectedDateStr);

            if (filteredRecords.length === 0) {
                listContainer.innerHTML = `<div class="text-center text-gray-300 py-10 text-xs">é€™å¤©æ²’æœ‰ç´€éŒ„å–”</div>`;
            }

            filteredRecords.forEach(r => {
                const d = new Date(r.date);
                const decor = categoryDecor[r.category] || categoryDecor['å…¶ä»–'];
                const displayName = (r.category === 'å…¶ä»–' && r.remark) ? r.remark : r.category;
                listContainer.innerHTML += `
                    <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm fade-in">
                        <div class="flex items-center">
                            <div class="w-10 h-10 ${decor.bg} rounded-xl flex items-center justify-center text-xl mr-3">${decor.emoji}</div>
                            <div>
                                <div class="font-bold text-soft-brown text-sm">${displayName}</div>
                                <div class="text-[10px] text-gray-300">${d.getMonth()+1}/${d.getDate()} Â· ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <div class="font-black text-lg ${decor.color} mr-3">-$${r.amount}</div>
                            <button onclick="deleteEntry(${r.id})" class="text-gray-200 text-xs">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            });
        }

        function selectDay(dateStr) {
            selectedDateStr = (selectedDateStr === dateStr) ? null : dateStr;
            render();
        }

        render();
    </script>
</body>
</html>
