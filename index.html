<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¯æ„›è¨˜å¸³æœ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#FFFBF5',
                        'soft-brown': '#6B5B55',
                        'cute-pink': '#FF9AA2',
                        'cute-blue': '#A2CFFE',
                        'cute-yellow': '#FDFD96',
                        'cute-green': '#B5EAD7',
                    },
                    borderRadius: {
                        '3xl': '1.5rem',
                        '4xl': '2rem',
                    }
                }
            }
        }
    </script>
    <style>
        /* è®“æ•´é«”å­—å‹çœ‹èµ·ä¾†æ›´åœ“æ½¤å‹å–„ */
        body { 
            font-family: "Nunito", "Noto Sans TC", sans-serif; 
            background-color: var(--cream); 
            color: var(--soft-brown);
            /* é˜²æ­¢æ‰‹æ©Ÿé»æ“Šæ™‚å‡ºç¾ç°è‰²å€å¡Š */
            -webkit-tap-highlight-color: transparent; 
        }
        /* æŒ‰éˆ•é»æ“Šæ™‚çš„å¯æ„›å½ˆè·³æ•ˆæœ */
        .btn-bounce:active { transform: scale(0.95); }
        /* ç§»é™¤æ•¸å­—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-cream p-6 min-h-screen bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSIjRkY5QUEyIiBmaWxsLW9wYWNpdHk9IjAuMSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIyIi8+PC9nPjwvc3ZnPg==')]">

    <header class="mt-16 mb-12 text-center">
        <p class="text-cute-pink font-bold tracking-widest mb-3 text-lg">âœ¨ é€™å€‹æœˆèŠ±äº†å¤šå°‘éŒ¢ï¼Ÿ</p>
        <h1 id="total-amount" class="text-6xl font-black tracking-tight text-cute-pink drop-shadow-sm" style="-webkit-text-stroke: 2px #fff;">$0</h1>
    </header>

    <main class="mb-32">
        <h2 class="text-cute-pink/80 font-bold text-sm mb-6 ml-2">ğŸŒ· æœ€è¿‘çš„å°æ•—å®¶ç´€éŒ„</h2>
        <div id="list" class="space-y-4">
            </div>
    </main>

    <button onclick="toggleModal()" class="btn-bounce fixed bottom-8 right-8 w-16 h-16 bg-cute-pink text-white rounded-full text-4xl shadow-lg shadow-cute-pink/40 flex items-center justify-center leading-none pb-1">+</button>

    <div id="modal" class="fixed inset-0 bg-cream/95 backdrop-blur-sm hidden p-6 z-50 flex flex-col justify-center transition-all duration-300 opacity-0 scale-95">
        <div class="bg-white p-8 rounded-4xl shadow-xl border-4 border-cute-pink/20">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-2xl font-bold text-cute-pink">ğŸ“ è¨˜ä¸Šä¸€ç­†</h3>
                <button onclick="toggleModal()" class="text-gray-400 hover:text-cute-pink bg-gray-100 hover:bg-pink-100 rounded-full w-10 h-10 font-bold">âœ•</button>
            </div>
            
            <div class="relative mb-10">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-4xl text-cute-pink font-bold">$</span>
                <input type="number" id="amount" placeholder="0" class="w-full text-5xl font-bold pl-12 pr-4 py-4 bg-pink-50 rounded-3xl text-cute-pink outline-none border-2 border-transparent focus:border-cute-pink transition-all text-center" autofocus>
            </div>
            
            <div class="grid grid-cols-4 gap-3 mb-10">
                <button onclick="setCategory('åƒå–', this)" class="cat-btn btn-bounce border-2 border-cute-pink text-cute-pink py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-pink-50">
                    <span class="text-2xl mb-1">ğŸ”</span>åƒå–
                </button>
                <button onclick="setCategory('äº¤é€š', this)" class="cat-btn btn-bounce border-2 border-cute-blue text-cute-blue py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-blue-50">
                    <span class="text-2xl mb-1">ğŸš—</span>äº¤é€š
                </button>
                <button onclick="setCategory('ç©æ¨‚', this)" class="cat-btn btn-bounce border-2 border-cute-yellow text-yellow-500 py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-yellow-50">
                    <span class="text-2xl mb-1">ğŸ‰</span>ç©æ¨‚
                </button>
                <button onclick="setCategory('å…¶ä»–', this)" class="cat-btn btn-bounce border-2 border-cute-green text-teal-500 py-3 rounded-2xl font-bold text-sm flex flex-col items-center bg-green-50">
                    <span class="text-2xl mb-1">ğŸ›ï¸</span>å…¶ä»–
                </button>
            </div>

            <button onclick="saveEntry()" class="btn-bounce w-full bg-cute-pink hover:bg-pink-400 text-white py-5 rounded-3xl font-bold text-xl shadow-lg shadow-pink-200">âœ¨ å­˜æª”ï¼</button>
        </div>
    </div>

    <script>
        let selectedCategory = 'å…¶ä»–';
        // å®šç¾©åˆ†é¡å°æ‡‰çš„è£é£¾ï¼ˆåœ–ç¤ºå’Œé¡è‰²ï¼‰
        const categoryDecor = {
            'åƒå–': { emoji: 'ğŸ”', colorClass: 'text-cute-pink', bgClass: 'bg-pink-100' },
            'äº¤é€š': { emoji: 'ğŸš—', colorClass: 'text-cute-blue', bgClass: 'bg-blue-100' },
            'ç©æ¨‚': { emoji: 'ğŸ‰', colorClass: 'text-yellow-500', bgClass: 'bg-yellow-100' },
            'å…¶ä»–': { emoji: 'ğŸ›ï¸', colorClass: 'text-teal-500', bgClass: 'bg-green-100' }
        };

        let records = JSON.parse(localStorage.getItem('my_cute_ledger') || '[]');

        // åˆ‡æ›å½ˆå‡ºè¦–çª—çš„é¡¯ç¤º/éš±è—ï¼Œä¸¦åŠ å…¥å‹•ç•«æ•ˆæœ
        function toggleModal() {
            const m = document.getElementById('modal');
            if (m.classList.contains('hidden')) {
                m.classList.remove('hidden');
                setTimeout(() => {
                    m.classList.remove('opacity-0', 'scale-95');
                    document.getElementById('amount').focus();
                    // é è¨­é¸ä¸­ç¬¬ä¸€å€‹åˆ†é¡
                    if(selectedCategory === 'å…¶ä»–') setCategory('åƒå–', document.querySelector('.cat-btn'));
                }, 10);
            } else {
                m.classList.add('opacity-0', 'scale-95');
                setTimeout(() => m.classList.add('hidden'), 300);
            }
        }

        // è¨­å®šé¸æ“‡çš„åˆ†é¡ï¼Œä¸¦æ”¹è®ŠæŒ‰éˆ•æ¨£å¼
        function setCategory(cat, btnElement) {
            selectedCategory = cat;
            // é‡ç½®æ‰€æœ‰æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('bg-cute-pink', 'bg-cute-blue', 'bg-cute-yellow', 'bg-cute-green', 'text-white', 'border-transparent');
                // å›å¾©åŸæœ¬çš„æ·ºè‰²èƒŒæ™¯
                if(btn.innerText.includes('åƒå–')) btn.classList.add('bg-pink-50', 'text-cute-pink');
                if(btn.innerText.includes('äº¤é€š')) btn.classList.add('bg-blue-50', 'text-cute-blue');
                if(btn.innerText.includes('ç©æ¨‚')) btn.classList.add('bg-yellow-50', 'text-yellow-500');
                if(btn.innerText.includes('å…¶ä»–')) btn.classList.add('bg-green-50', 'text-teal-500');
            });

            // è¨­å®šè¢«é¸ä¸­æŒ‰éˆ•çš„æ¨£å¼ (è®Šæˆå¯¦å¿ƒé¡è‰²)
            btnElement.classList.remove('bg-pink-50', 'bg-blue-50', 'bg-yellow-50', 'bg-green-50', 'text-cute-pink', 'text-cute-blue', 'text-yellow-500', 'text-teal-500');
            btnElement.classList.add('text-white', 'border-transparent');
            if(cat === 'åƒå–') btnElement.classList.add('bg-cute-pink');
            if(cat === 'äº¤é€š') btnElement.classList.add('bg-cute-blue');
            if(cat === 'ç©æ¨‚') btnElement.classList.add('bg-cute-yellow');
            if(cat === 'å…¶ä»–') btnElement.classList.add('bg-cute-green');
        }

        // å„²å­˜ç´€éŒ„
        function saveEntry() {
            const amountInput = document.getElementById('amount');
            const amount = amountInput.value;
            if(!amount || amount <= 0) {
                // ç°¡å–®çš„æ–æ™ƒå‹•ç•«æç¤ºéŒ¯èª¤
                amountInput.classList.add('animate-bounce');
                setTimeout(() => amountInput.classList.remove('animate-bounce'), 500);
                return;
            }
            
            const entry = {
                id: Date.now(), // ç”¨æ™‚é–“æˆ³è¨˜ç•¶ä½œå”¯ä¸€ ID
                amount: parseFloat(amount),
                category: selectedCategory,
                date: new Date().toISOString()
            };

            records.unshift(entry);
            localStorage.setItem('my_cute_ledger', JSON.stringify(records));
            
            amountInput.value = '';
            toggleModal();
            render();
        }

        // æ¸²æŸ“ç•«é¢
        function render() {
            const list = document.getElementById('list');
            const totalDisplay = document.getElementById('total-amount');
            let total = 0;
            const now = new Date();

            list.innerHTML = '';
            
            if (records.length === 0) {
                list.innerHTML = `<div class="text-center text-gray-400 py-10">é‚„æ²’æœ‰ç´€éŒ„ï¼Œå¿«å»èŠ±éŒ¢éŒ¢ï¼(èª¤)</div>`;
            }

            records.forEach((r, index) => {
                const date = new Date(r.date);
                // ç´¯è¨ˆç•¶æœˆæ”¯å‡º
                if(date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear()) {
                    total += r.amount;
                }

                // åªé¡¯ç¤ºæœ€è¿‘ 15 ç­†
                if(index < 15) {
                    const decor = categoryDecor[r.category] || categoryDecor['å…¶ä»–'];
                    const timeString = `${date.getMonth()+1}/${date.getDate()} Â· ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                    
                    // æ¯ä¸€ç­†ç´€éŒ„çš„å¡ç‰‡æ¨£å¼
                    list.innerHTML += `
                        <div class="flex justify-between items-center bg-white p-4 rounded-3xl shadow-sm border-2 border-pink-50/50">
                            <div class="flex items-center">
                                <div class="w-12 h-12 ${decor.bgClass} rounded-2xl flex items-center justify-center text-2xl mr-4">
                                    ${decor.emoji}
                                </div>
                                <div>
                                    <div class="font-bold text-soft-brown">${r.category}</div>
                                    <div class="text-gray-400 text-xs mt-1">${timeString}</div>
                                </div>
                            </div>
                            <div class="font-black text-xl ${decor.colorClass}">-$${r.amount}</div>
                        </div>
                    `;
                }
            });

            // æ›´æ–°ç¸½é‡‘é¡é¡¯ç¤º
            totalDisplay.innerText = `$${total.toLocaleString()}`;
        }

        // åˆå§‹æ¸²æŸ“
        render();
    </script>
</body>
</html>
